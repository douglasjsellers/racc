<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="ja-JP">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-2022-jp">
  <meta http-equiv="Content-Language" content="ja-JP">
<title>class <a name="Racc%3a%3aParser">Racc::Parser</a> </title>
</head>
<body>

<h1>class <a name="Racc%3a%3aParser">Racc::Parser</a> </h1>
<p>
Racc の生成するパーサはすべて <a href="parser.html#Racc%3a%3aParser">Racc::Parser</a> クラスを継承します。
<a href="parser.html#Racc%3a%3aParser">Racc::Parser</a> クラスにはパース中に使用するメソッドがいくつかあり、
そのようなメソッドをオーバーロードすると、パーサを初期化したり
することができます。
</p>
<h2>Super Class</h2>
<p>
Object
</p>
<h2>Constants</h2>
<p>
プリフィクス &quot;Racc_&quot; がついた定数はパーサの予約定数です。
そのような定数は使わないでください。動作不可能になります。
</p>
<h2>インスタンスメソッド</h2>
<p>
ここに載っているもののほか、プリフィクス &quot;racc_&quot; および &quot;_racc_&quot; が
ついたメソッドはパーサの予約名です。そのようなメソッドは使わないで
ください。
</p>
<dl>
<dt><a name="Racc%3a%3aParser-do_parse">do_parse</a> → Object</dt>
<dd><p>
パースを開始します。
また、トークンが必要になった時は <a href="parser.html#Racc%3a%3aParser-next_token">#next_token</a> を呼び出します。
</p>
<pre>
     # Example
     ---- inner
       def parse
         @q = [[1,1],
               [2,2],
               [3,3],
               [false, '$']]
         do_parse
       end

       def next_token
         @q.shift
       end
</pre>
</dd>
<dt><a name="Racc%3a%3aParser-next_token">next_token</a> → [Symbol, Object]</dt>
<dd><p>
[abstract method]
</p>
<p>
パーサが次のトークンを読みこむ時に使います。
[記号, その値] の形式の配列を返してください。
記号はデフォルトでは
</p>
<ul>
<li>文法中、引用符でかこまれていないもの
→ その名前の文字列のシンボル (例えば :ATOM )</li>
<li>引用符でかこまれているもの&lt;br&gt;
→ その文字列そのまま (例えば '=' )</li>
</ul>
<p>
で表します。これを変更する方法については、
文法リファレンスを参照してください。
</p>
<p>
また、もう送るシンボルがなくなったときには
[false, なにか] または nil を返してください。
</p>
<p>
このメソッドは抽象メソッドなので、<a href="parser.html#Racc%3a%3aParser-do_parse">#do_parse</a> を使う場合は
必ずパーサクラス中で再定義する必要があります。
定義しないままパースを始めると例外 NotImplementedError が
発生します。
</p>
</dd>
<dt><a name="Racc%3a%3aParser-yyparse">yyparse( <var>receiver</var>, <var>method_id</var> )</a></dt>
<dd><p>
パースを開始します。このメソッドでは始めてトークンが
必要になった時点で <var>receiver</var> に対して <var>method_id</var> メソッドを
呼び出してトークンを得ます。
</p>
<p>
<var>receiver</var> の <var>method_id</var> メソッドはトークンを yield しなければ
なりません。形式は <a href="parser.html#Racc%3a%3aParser-next_token">#next_token</a> と同じで [記号, 値] です。
つまり、<var>receiver</var> の <var>method_id</var> メソッドの概形は以下のように
なるはずです。
</p>
<pre>
def method_id
  until end_of_file
        :
    yield 記号, 値
        :
  end
end
</pre>
<p>
少し注意が必要なのは、<var>method_id</var> が呼び出されるのは始めて
トークンが必要になった時点であるということです。<var>method_id</var>
メソッドが呼び出されたときは既にパースが進行中なので、
アクション中で使う変数を <var>method_id</var> の冒頭で初期化すると
まず失敗します。
</p>
<p>
トークンの終端を示す [false, なにか] を渡したらそれ以上は
yield しないでください。その場合には例外が発生します。
</p>
<p>
最後に、<var>method_id</var> メソッドからは必ず yield してください。
しない場合は何が起きるかわかりません。
</p>
</dd>
<dt><a name="Racc%3a%3aParser-on_error">on_error( <var>error_token_id</var>, <var>error_value</var>, <var>value_stack</var> )</a></dt>
<dd><p>
パーサコアが文法エラーを検出すると呼び出します (yacc の yyerror)。
エラーメッセージを出すなり、例外を発生するなりしてください。
このメソッドから正常に戻った場合、パーサはエラー回復モード
に移行します。
</p>
<p>
error_token はパースエラーを起こした記号の内部表現 (整数) です。
<a href="parser.html#Racc%3a%3aParser-token_to_str">#token_to_str</a> で文法ファイル上の文字列表現に直せます。
</p>
<p>
<var>error_value</var> はその値です。
</p>
<p>
<var>value_stack</var> はエラーの時点での値スタックです。
<var>value_stack</var> を変更してはいけません。
</p>
<p>
on_error のデフォルトの実装は例外 ParseError を発生します。
</p>
</dd>
<dt><a name="Racc%3a%3aParser-token_to_str">token_to_str( <var>t</var> )</a> → String</dt>
<dd><p>
Racc トークンの内部表現 (整数)
を文法ファイル上の記号表現の文字列に変換します。
</p>
<p>
<var>t</var> が整数でない場合は TypeError を発生します。
<var>t</var> が範囲外の整数だった場合は nil を返します。
</p>
</dd>
<dt><a name="Racc%3a%3aParser-yyerror">yyerror</a></dt>
<dd><p>
エラー回復モードに入ります。このとき <a href="parser.html#Racc%3a%3aParser-on_error">#on_error</a> は呼ばれません。
アクション以外からは呼び出さないでください。
</p>
</dd>
<dt><a name="Racc%3a%3aParser-yyerrok">yyerrok</a></dt>
<dd><p>
エラー回復モードから復帰します。
アクション以外からは呼び出さないでください。
</p>
</dd>
<dt><a name="Racc%3a%3aParser-yyaccept">yyaccept</a></dt>
<dd><p>
すぐに値スタックの先頭の値を返して <a href="parser.html#Racc%3a%3aParser-do_parse">#do_parse</a>、<a href="parser.html#Racc%3a%3aParser-yyparse">#yyparse</a> を抜けます。
</p>
</dd>
</dl>

</body>
</html>
